FROM ubuntu:16.04
MAINTAINER Piotr Krysik

RUN apt-get update && apt-get install -y \
    python-pip \
    python-apt

RUN pip install PyBOMBS && \
    pybombs auto-config && \
    pybombs recipes add-defaults

RUN pybombs -y prefix init ~/prefix  -a myprefix

RUN cat ~/prefix/.pybombs/config.yml |     \
    awk '{ if((lastLine ~ "gnuradio:") || \
           (lastLine ~ "hardware:"))      \
           {printf "    forcebuild: false\n"} \
           else{print} { lastLine = $0 }}' > \
           ~/prefix/.pybombs/config.yml.tmp && \
           mv -f ~/prefix/.pybombs/config.yml.tmp ~/prefix/.pybombs/config.yml

RUN pybombs -y install gr-gsm


WORKDIR ~/prefix/src/gr-gsm/
#RUN git checkout $TRAVIS_COMMIT
WORKDIR ~/prefix/src/gr-gsm/build

RUN make && \
    make test
